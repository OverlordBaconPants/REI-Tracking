{% extends "base.html" %}
{% block body_class %}edit-properties-page{% endblock %}
{% block title %}Edit Property{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card mt-3">
                <div class="card-header bg-navy">
                    <h4 class="mb-0">Edit Property</h4>
                </div>
                <div class="card-body p-3">
                    <form id="editPropertyForm" method="POST">
                        <!-- Property Selection -->
                        <div class="card mb-4">
                            <div class="card-header bg-navy">
                                <h5 class="mb-0">Select Property</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="property_select" class="form-label">Choose Property to Edit:</label>
                                    <select id="property_select" 
                                            name="property_select" 
                                            class="form-select" 
                                            required>
                                        <option value="">Select a property...</option>
                                        {% for property in properties %}
                                            <option value="{{ property.address }}">{{ property.address }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                        <div id="propertyDetails" class="hidden">
                            <!-- Property Information -->
                            <div class="card mb-4">
                                <div class="card-header bg-navy">
                                    <h5 class="mb-0">Property Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="purchase-date" class="form-label">Purchase Date</label>
                                                <input type="date" 
                                                       id="purchase-date" 
                                                       name="purchase_date" 
                                                       class="form-control" 
                                                       required>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="purchase-price" class="form-label">Purchase Price</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="purchase-price" 
                                                           name="purchase_price" 
                                                           class="form-control" 
                                                           required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="down-payment" class="form-label">Down Payment</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="down-payment" 
                                                           name="down_payment" 
                                                           class="form-control" 
                                                           required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="closing-costs" class="form-label">Closing Costs</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="closing-costs" 
                                                           name="closing_costs" 
                                                           class="form-control" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="renovation-costs" class="form-label">Renovation Costs</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="renovation-costs" 
                                                           name="renovation_costs" 
                                                           class="form-control" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="marketing-costs" class="form-label">Marketing Costs</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="marketing-costs" 
                                                           name="marketing_costs" 
                                                           class="form-control" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Loan Information -->
                            <div class="card mb-4">
                                <div class="card-header bg-navy">
                                    <h5 class="mb-0">Loan Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="loan-amount" class="form-label">Loan Amount</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="loan-amount" 
                                                           name="loan_amount" 
                                                           class="form-control" 
                                                           required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="loan-start-date" class="form-label">Loan Start Date</label>
                                                <input type="date" 
                                                       id="loan-start-date" 
                                                       name="loan_start_date" 
                                                       class="form-control" 
                                                       required>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="primary-loan-rate" class="form-label">Primary Loan Rate</label>
                                                <div class="input-group">
                                                    <input type="number" 
                                                           id="primary-loan-rate" 
                                                           name="primary_loan_rate" 
                                                           class="form-control" 
                                                           step="0.01" 
                                                           required>
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="primary-loan-term" class="form-label">Primary Loan Term</label>
                                                <div class="input-group">
                                                    <input type="number" 
                                                           id="primary-loan-term" 
                                                           name="primary_loan_term" 
                                                           class="form-control" 
                                                           required>
                                                    <span class="input-group-text">months</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Secondary Financing -->
                                        <div class="col-12">
                                            <h6 class="mt-3 mb-3">Secondary Financing</h6>
                                        </div>

                                        <div class="col-12 col-md-4">
                                            <div class="form-group">
                                                <label for="seller-financing-amount" class="form-label">Seller Financing Amount</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="seller-financing-amount" 
                                                           name="seller_financing_amount" 
                                                           class="form-control" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-4">
                                            <div class="form-group">
                                                <label for="seller-financing-rate" class="form-label">Seller Financing Rate</label>
                                                <div class="input-group">
                                                    <input type="number" 
                                                           id="seller-financing-rate" 
                                                           name="seller_financing_rate" 
                                                           class="form-control" 
                                                           step="0.01" 
                                                           value="0">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-4">
                                            <div class="form-group">
                                                <label for="seller-financing-term" class="form-label">Seller Financing Term</label>
                                                <div class="input-group">
                                                    <input type="number" 
                                                           id="seller-financing-term" 
                                                           name="seller_financing_term" 
                                                           class="form-control" 
                                                           value="0">
                                                    <span class="input-group-text">months</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Monthly Income -->
                            <div class="card mb-4">
                                <div class="card-header bg-navy text-white">
                                    <h5 class="mb-0">Monthly Income</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="rental-income" class="form-label">Rental Income</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="rental-income" 
                                                           name="monthly_income[rental_income]" 
                                                           class="form-control income-input" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="parking-income" class="form-label">Parking Income</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="parking-income" 
                                                           name="monthly_income[parking_income]" 
                                                           class="form-control income-input" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="laundry-income" class="form-label">Laundry Income</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="laundry-income" 
                                                           name="monthly_income[laundry_income]" 
                                                           class="form-control income-input" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <label for="other-income" class="form-label">Other Income</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="other-income" 
                                                           name="monthly_income[other_income]" 
                                                           class="form-control income-input" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="income-notes" class="form-label">Income Notes</label>
                                                <textarea id="income-notes" 
                                                          name="monthly_income[income_notes]" 
                                                          class="form-control" 
                                                          rows="3"></textarea>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="alert alert-success">
                                                <strong>Total Monthly Income:</strong> 
                                                $<span id="total-monthly-income">0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Monthly Expenses -->
                            <div class="card mb-4">
                                <div class="card-header bg-navy text-white">
                                    <h5 class="mb-0">Monthly Expenses</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <!-- Fixed Expenses -->
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">Fixed Expenses</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="property-tax" class="form-label">Property Tax</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="property-tax" 
                                                                           name="monthly_expenses[property_tax]" 
                                                                           class="form-control expense-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="insurance" class="form-label">Insurance</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="insurance" 
                                                                           name="monthly_expenses[insurance]" 
                                                                           class="form-control expense-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="hoa-fees" class="form-label">HOA Fees</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="hoa-fees" 
                                                                           name="monthly_expenses[hoa_fees]" 
                                                                           class="form-control expense-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Percentage Based Expenses -->
                                        <div class="col-12 col-lg-6">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">Percentage Based Expenses</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="repairs" class="form-label">Repairs</label>
                                                                <div class="input-group">
                                                                    <input type="number" 
                                                                           id="repairs" 
                                                                           name="monthly_expenses[repairs]" 
                                                                           class="form-control expense-input expense-percent" 
                                                                           step="0.01" 
                                                                           min="0" 
                                                                           max="100"
                                                                           value="0">
                                                                    <span class="input-group-text">% of Rent</span>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="capex" class="form-label">CapEx</label>
                                                                <div class="input-group">
                                                                    <input type="number" 
                                                                           id="capex" 
                                                                           name="monthly_expenses[capex]" 
                                                                           class="form-control expense-input expense-percent" 
                                                                           step="0.01" 
                                                                           min="0" 
                                                                           max="100"
                                                                           value="0">
                                                                    <span class="input-group-text">% of Rent</span>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="property-management" class="form-label">Property Management</label>
                                                                <div class="input-group">
                                                                    <input type="number" 
                                                                           id="property-management" 
                                                                           name="monthly_expenses[property_management]" 
                                                                           class="form-control expense-input expense-percent" 
                                                                           step="0.01" 
                                                                           min="0" 
                                                                           max="100"
                                                                           value="0">
                                                                    <span class="input-group-text">% of Rent</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Utilities -->
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">Utilities</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-sm-6 col-lg-3">
                                                            <div class="form-group">
                                                                <label for="water" class="form-label">Water</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="water" 
                                                                           name="monthly_expenses[utilities][water]" 
                                                                           class="form-control expense-input utility-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12 col-sm-6 col-lg-3">
                                                            <div class="form-group">
                                                                <label for="electricity" class="form-label">Electricity</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="electricity" 
                                                                           name="monthly_expenses[utilities][electricity]" 
                                                                           class="form-control expense-input utility-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12 col-sm-6 col-lg-3">
                                                            <div class="form-group">
                                                                <label for="gas" class="form-label">Gas</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="gas" 
                                                                           name="monthly_expenses[utilities][gas]" 
                                                                           class="form-control expense-input utility-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12 col-sm-6 col-lg-3">
                                                            <div class="form-group">
                                                                <label for="trash" class="form-label">Trash</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" 
                                                                           id="trash" 
                                                                           name="monthly_expenses[utilities][trash]" 
                                                                           class="form-control expense-input utility-input" 
                                                                           value="0">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Other Expenses -->
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="other-expenses" class="form-label">Other Expenses</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" 
                                                           id="other-expenses" 
                                                           name="monthly_expenses[other_expenses]" 
                                                           class="form-control expense-input" 
                                                           value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="expense-notes" class="form-label">Expense Notes</label>
                                                <textarea id="expense-notes" 
                                                          name="monthly_expenses[expense_notes]" 
                                                          class="form-control" 
                                                          rows="3"></textarea>
                                            </div>
                                        </div>

                                        <!-- Summary -->
                                        <div class="col-12">
                                            <div class="card bg-navy">
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6">
                                                            <div class="alert alert-danger mb-0">
                                                                <strong>Total Monthly Expenses:</strong> 
                                                                $<span id="total-monthly-expenses">0.00</span>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 col-md-6">
                                                            <div class="alert alert-success mb-0">
                                                                <strong>Net Monthly Income:</strong> 
                                                                $<span id="net-monthly-income">0.00</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="d-grid gap-2 d-md-flex">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-save me-2"></i>Update Property
                                        </button>
                                        <a href="{{ url_for('properties.edit_properties') }}" class="btn btn-secondary">
                                            <i class="bi bi-x-circle me-2"></i>Cancel
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module">
    import { init } from '/static/js/main.js';
    import editPropertiesModule from '/static/js/modules/edit_properties.js';

    document.addEventListener('DOMContentLoaded', function() {
        if (window.mainInit) {
            window.mainInit();
        }
    });
</script>
{% endblock %}